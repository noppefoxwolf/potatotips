slidenumbers: true

# UIのブラックボックスを探る

## iOSDC23 day1 Track B noppe

^ UIのブラックボックスを探るというタイトルで発表します。よろしくお願いします。

---

## noppe

- iOS app dev
- DeNA Co., Ltd.
  - Pococha
- きつねが好き
- 個人開発
  - vear
  - Editormode
  - Nightfox DAWN for mastodon

![right fit](profile.png)

^ noppeと言います

---

# 脳内プレビュー大会 in DeNAブース

- SwiftUIのコードから、脳内で実行結果を予想する
- コード → GUI

// TODO: 画像

^ そして、現在オフライン会場ではDeNAブースで脳内プレビューイベントを開催しています。このイベントは、SwiftUIのコードから、脳内で実行結果を予想し、紙にUIを描いて提出するというものです。ぜひ、遊びに来てください。

---

## 今日話すこと

- 実行結果から、コードや仕様を予測する

- コード ← GUI

// TODO: 画像

^ そして先に紹介しておくと、今日は逆にUIからコードや仕様を予測するにはどうすれば良いのかということについて話します。

---

# Agenda

- UIのブラックボックスとは
- UIの解剖学
- まとめ

^ さて、今日は、このような流れで話します。
^ まず、タイトルにもなっているブラックボックスとは、これはこのトークのための言葉ですが、何なのか、どうしてそれを知る必要があるのかについて話します。
^ 次に、そのブラックボックスの中身を明らかにし、理解するための実践的なテクニックをいくつか紹介します
^ 最後に、まとめとなります。

---

# UIのブラックボックスとは

^ さて、まずはUIのブラックボックスとは何なのかについて話します。
^ 繰り返しになりますが、これはこのトークのための言葉なので、一般的な定義ではないことを断っておきます。

---

# UIのブラックボックスとは

// TODO: アプリのカスタムUIの画像

^ 我々がアプリを作るときに、ほぼ必ず独自のUIコンポーネントを作ります。
^ これは、アプリの世界観やアイデンティティを構築するために必要だったり、既存のシステムコンポーネントに不足しているコントロールを補うために必要だったりします。
^ カレンダーだったり、グラフだったり、画像ビューアだったり。

---

# UIのブラックボックスとは

// TODO: カスタムUIが微妙な画像

^ しかし、多くのケースで、我々が作るカスタムUIは、システムコンポーネントと比べて品質が低いと言えます。なんだかバランスが悪いとか、誰かにとって使いづらいとか、そもそも使いにくいとか。
^ どうしてこの問題が起きてしまうのでしょうか

---

# UIのブラックボックスとは

- システムコンポーネントのお作法に乗っ取っていないから

// TODO: スクロール・キーボード

^ それは、システムコンポーネントのお作法に乗っ取っていないから。
^ ユーザーは、iOSという巨大なお作法の上に則って、アプリを使っています。
^ スクロールの慣性や、タップエリア、アクセシビリティ、アニメーション、文字の大きさ、太さなどなど。
^ これらのお作法を無視して、独自のUIコンポーネントを作ると、ユーザーは違和感を感じてしまいます。

---

# UIのブラックボックスとは

仕様で考慮されない暗黙のお作法 = ブラックボックス

^ このお作法こそ、UIにおけるブラックボックスな訳です。
^ 特に最近はSwiftUIを使えば、暗黙的にお作法に乗っ取ったUIを作ることができるため、独自のUIコンポーネントとの差が顕著になってしまいます。
<!-- 時間あまりそうなら、なぜブラックボックスになってしまうのかを解説する -->
<!-- 組織で関心が持てるのがエンジニアだけだから、デザインをそのまま実装してハリボテを通してしまうから -->

---

# お作法を知るには

- Human Interface Guideline
  - 基本的なお作法はこれ
- システムコンポーネントを分析する
  - HIGに書かれていないお作法を見つける

^ お作法を知る基本はHIGを読むことです。例えば、フォントサイズや、推奨されるボタンのサイズなど、基本的なお作法はHIGに書かれています。
^ それを前提に、実際にどういった値で実装されているのか、エッジケースの場合の挙動はどうなっているのかは、システムコンポーネントを分析して解明する必要があります。

---

# カスタムナビゲーションバーの例

^ 一つ、例を挙げてみます。
^ これから、カスタムナビゲーションバーを作ってみます。

---

# カスタムナビゲーションバーの例

---

ナビゲーションバーを実装するとき

- ナビゲーションバーの高さは、44pt
- ナビゲーションバーの背景色は、白
- ナビゲーションバーのタイトルは、中央寄せ
- ナビゲーションバーのタイトルのフォントは、SF Pro Display 17pt Bold
- ナビゲーションバーのタイトルの色は、黒
- ナビゲーションバーのタイトルの影は、なし

という条件を満たすために、カスタムナビゲーションを作ると大体の場合でロングプレスジェスチャーの実装を忘れる
これは、この機能を必要としている人にとってシステムコンポーネントよりも品質の低いUIであると言えます。

---

# 解明する力を養うには

- HIG読む
- システムコンポーネントをとことん解剖する
- システムコンポーネントは、品質の理想値

---

# システムコンポーネントの解剖

- 見る
- 触る
- 聞く
- 構造を分析する

^ 例を挙げて解説していく

---

# 見る

- 基本中の基本
- デザインが無く、エンジニアがデザインする時に効果的
- 基本はスクショや画面録画をして計測、実装して比較する
  - 一番簡単で確実

---

## サイズ

- スクショを撮影して、測る
- 画面のスケールを割った値が、実際にCGRectで指定する値

---

## サイズの例

- ボタンサイズ
- ラインの太さ

---

## 色

- スクショを撮影して、測る
- ダイナミックカラーはダークモードなどで色が変わるので注意
- 単色で無い場合も多いので注意

---

## 色の例

- 背景色

---

## アニメーション

- スクリーンレコードをして、フレームを確認する
- iinaを使えば、フレーム単位でコマ送りできる

---

## より詳しく見る

- lookin, Reveal, XcodeのDebug View Hierarchyなどのツールを使う
- これらのツールは、アプリのUIを解析して、UIの構造を可視化する
- これで直接答えを得ることができる

---

# デモ

- lookin

---

# 触る

---

## インタラクション・ジェスチャー

- タップ、スワイプ、ピンチなどのジェスチャーを実際に試す
- タップ位置を可視化するツールを使うと、実際のタップ位置や動きからズラしていることもわかる
- 不可視のジェスチャーもあるので注意
  - シェイク、マルチタップ、3Dタッチなど
- ポインターAPI

---

## 動的な要素

- 見るだけではわからない要素もある
- 例えば、ボタンの有効無効や、セルの表示・非表示など
- 状態を見つけたら、再度観察をする

---

## アクセシビリティ

- VoiceOverなどのアクセシビリティ機能を使う
- アクセシビリティ機能は、UIを変化させる

---

## 聞く

---

## 効果音・haptic feedback

---

# 構造を分析する

---

## subview探索

- subviewsプロパティを使う

---

## クラス名からメソッドリストを探す

- Objective-Cの場合は、クラス名からメソッドリストを探す

---

## invoke method

- なんでもできる

---

## ただし

- OSによってこれらの表現は異なる
- 解釈が一致するとは限らない

---

## まとめ

---

## おわり
